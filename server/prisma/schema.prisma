generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./single_user.db"
}

// User model removed for single user mode
// All data belongs to the single local user

model Chat {
  id           String            @id @default(cuid())
  title        String?
  metadata     Json?
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt

  messages     Message[]
}

// ChatParticipant model removed for single user mode
// All chats belong to the single local user

model Message {
  id        String   @id @default(cuid())
  content   String
  createdAt DateTime @default(now())
  
  // Store sender as simple string instead of foreign key
  senderType String  // "user" or "ai"
  chatId     String

  chat   Chat @relation(fields: [chatId], references: [id], onDelete: Cascade)

  // Relacja wskazujca, 偶e wiadomo mo偶e mie wiele zacznik贸w.
  attachments Attachment[]
}

//  --- DODANY CAY MODEL ---
// Reprezentuje pojedynczy plik zaczony do wiadomoci.
model Attachment {
  id        String   @id @default(cuid())
  url       String   // URL do pliku w chmurze (np. AWS S3)
  filename  String   // Oryginalna nazwa pliku
  mimetype  String   // Typ MIME, np. "image/png" czy "application/pdf"
  size      Int      // Rozmiar pliku w bajtach
  createdAt DateTime @default(now())

  // Relacja zwrotna do wiadomoci
  messageId String
  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)
}

//  --- PAMI WEKTOROWA ---
// G贸wna tabela przechowujca wpisy pamici wektorowej
model VectorMemory {
  id              String   @id @default(cuid())
  content         String   // Oryginalny tekst wiadomoci
  embedding       String   // Wektor embeddings (stored as JSON string for SQLite)
  importanceScore Float    @default(0.5) // Ocena wa偶noci 0-1
  timestamp       DateTime @default(now())
  
  // Relacje (no userId needed for single user mode)
  chatId          String
  messageId       String?  // Opcjonalne - mo偶e by null dla zagregowanych wspomnie
  
  // Kontekst i metadane
  context         String?  // Kilka poprzednich wiadomoci jako kontekst
  tags            String   // Automatycznie generowane tagi (stored as JSON string)
  metadata        String?  // Dodatkowe metadane (stored as JSON string)
  
  // Indeksy dla wydajnoci
  @@index([chatId])  
  @@index([timestamp])
  @@index([importanceScore])
}

// Tabela do przechowywania konfiguracji u偶ytkownika dla pamici (single user)
model MemorySettings {
  id                    String  @id @default(cuid())
  importanceThreshold   Float   @default(0.3) // Pr贸g wa偶noci dla zapisywania
  maxMemoryEntries      Int     @default(10000) // Maksymalna liczba wpis贸w
  retentionDays         Int     @default(365) // Ile dni przechowywa wpisy
  autoCleanupEnabled    Boolean @default(true)
  
  // Nowe opcje prywatnoci
  memoryEnabled         Boolean @default(true) // Czy w og贸le zapisywa do pamici
  autoDeleteOnChatRemoval Boolean @default(true) // Czy automatycznie usuwa pami przy usuwaniu czatu
  incognitoMode         Boolean @default(false) // Tryb incognito - nie zapisuj nic
  shareMemoryAcrossChats Boolean @default(true) // Czy dzieli pami midzy r贸偶nymi czatami
  memoryAggressiveness  String  @default("conservative") // Poziom agresywnoci: conservative/moderate/aggressive
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}